# Requirements Document

## Введение

Данный документ описывает требования к системе публикации контента авторами, управлению пользователями и ролями в админ-панели, а также модерации комментариев. Система позволит авторизованным пользователям с ролью "автор" или "администратор" создавать и редактировать публикации, а администраторам — управлять пользователями и модерировать комментарии.

## Глоссарий

- **Автор** — пользователь с ролью `author`, имеющий право создавать и редактировать свои публикации
- **Администратор** — пользователь с ролью `admin`, имеющий полный доступ к управлению контентом и пользователями
- **Публикация** — статья блога с заголовком, содержимым, категорией и тегами
- **Модерация** — процесс проверки и одобрения/отклонения комментариев

## Требования

### Требование 1: Система ролей пользователей

**User Story:** Как администратор, я хочу назначать роли пользователям, чтобы контролировать их права доступа в системе.

#### Критерии приёмки

1. WHEN пользователь регистрируется THEN система SHALL назначить роль `user` по умолчанию
2. WHEN администратор переходит в раздел управления пользователями THEN система SHALL отобразить список всех пользователей с их ролями
3. WHEN администратор изменяет роль пользователя THEN система SHALL сохранить новую роль и применить соответствующие права
4. WHILE пользователь имеет роль `author` THEN система SHALL разрешить создание и редактирование своих публикаций
5. WHILE пользователь имеет роль `admin` THEN система SHALL разрешить полный доступ ко всем функциям системы
6. WHILE пользователь имеет роль `user` THEN система SHALL разрешить только просмотр контента и комментирование
7. IF пользователь без роли `author` или `admin` пытается создать публикацию THEN система SHALL вернуть 403 Forbidden

### Требование 2: Управление пользователями в админ-панели

**User Story:** Как администратор, я хочу управлять пользователями через админ-панель, чтобы контролировать доступ к системе.

#### Критерии приёмки

1. WHEN администратор переходит на `/admin/user` THEN система SHALL отобразить список пользователей с пагинацией и фильтрами
2. WHEN администратор просматривает список пользователей THEN система SHALL показать: username, email, роль, статус, дату регистрации
3. WHEN администратор нажимает "Редактировать" у пользователя THEN система SHALL отобразить форму с полями: username, email, роль, статус
4. WHEN администратор изменяет статус пользователя на "заблокирован" THEN система SHALL запретить вход этому пользователю
5. WHEN администратор удаляет пользователя THEN система SHALL удалить аккаунт и связанные данные (профиль, закладки)
6. IF не-администратор пытается получить доступ к `/admin/user` THEN система SHALL вернуть 403 Forbidden

### Требование 3: Создание публикаций авторами

**User Story:** Как автор, я хочу создавать публикации через удобный интерфейс, чтобы делиться контентом с читателями.

#### Критерии приёмки

1. WHEN автор переходит на `/publication/create` THEN система SHALL отобразить форму создания с полями: title, slug, content, category, tags, cover_image, status
2. WHEN автор заполняет форму и нажимает "Сохранить" THEN система SHALL создать публикацию с указанным автором (author_id)
3. WHEN автор оставляет slug пустым THEN система SHALL автоматически сгенерировать slug из заголовка (транслитерация)
4. WHEN автор выбирает статус "черновик" THEN система SHALL сохранить публикацию без отображения на сайте
5. WHEN автор выбирает статус "опубликовано" THEN система SHALL опубликовать статью с текущей датой
6. WHEN автор загружает обложку THEN система SHALL оптимизировать изображение через ImageOptimizer
7. IF пользователь без роли `author` или `admin` пытается создать публикацию THEN система SHALL вернуть 403 Forbidden

### Требование 4: Редактирование публикаций авторами

**User Story:** Как автор, я хочу редактировать свои публикации, чтобы исправлять ошибки и обновлять контент.

#### Критерии приёмки

1. WHEN автор переходит на `/publication/{id}/edit` своей публикации THEN система SHALL отобразить форму редактирования с текущими данными
2. WHEN автор сохраняет изменения THEN система SHALL обновить публикацию и updated_at
3. WHEN автор пытается редактировать чужую публикацию THEN система SHALL вернуть 403 Forbidden
4. WHILE пользователь имеет роль `admin` THEN система SHALL разрешить редактирование любой публикации
5. WHEN автор удаляет свою публикацию THEN система SHALL удалить публикацию и связанные данные (комментарии, закладки)
6. IF публикация не найдена THEN система SHALL вернуть 404 Not Found

### Требование 5: Список публикаций автора

**User Story:** Как автор, я хочу видеть список своих публикаций, чтобы управлять своим контентом.

#### Критерии приёмки

1. WHEN автор переходит на `/publication/my` THEN система SHALL отобразить список его публикаций с пагинацией
2. WHEN автор просматривает список THEN система SHALL показать: заголовок, статус, дату создания, количество просмотров, комментариев
3. WHEN автор фильтрует по статусу THEN система SHALL отобразить только публикации с выбранным статусом
4. WHEN автор нажимает на публикацию THEN система SHALL перенаправить на страницу редактирования
5. IF у автора нет публикаций THEN система SHALL отобразить сообщение "У вас пока нет публикаций" с кнопкой создания

### Требование 6: Модерация комментариев в админ-панели

**User Story:** Как администратор, я хочу модерировать комментарии через админ-панель, чтобы контролировать качество обсуждений.

#### Критерии приёмки

1. WHEN администратор переходит на `/admin/comment` THEN система SHALL отобразить список комментариев с фильтрами по статусу
2. WHEN администратор просматривает список THEN система SHALL показать: автор/гость, публикация, текст (превью), рейтинг, статус, дата
3. WHEN администратор нажимает "Одобрить" THEN система SHALL изменить статус на `approved` и отобразить комментарий на сайте
4. WHEN администратор нажимает "Отклонить" THEN система SHALL изменить статус на `rejected`
5. WHEN администратор нажимает "Спам" THEN система SHALL изменить статус на `spam`
6. WHEN администратор нажимает "Удалить" THEN система SHALL удалить комментарий из базы данных
7. WHEN администратор фильтрует по статусу "На модерации" THEN система SHALL отобразить только комментарии со статусом `pending`
8. IF не-администратор пытается получить доступ к `/admin/comment` THEN система SHALL вернуть 403 Forbidden

### Требование 7: Навигация для авторов

**User Story:** Как автор, я хочу иметь удобную навигацию для управления публикациями, чтобы быстро переходить к нужным разделам.

#### Критерии приёмки

1. WHILE пользователь авторизован как автор или админ THEN система SHALL отобразить в header ссылку "Мои публикации"
2. WHILE пользователь авторизован как автор или админ THEN система SHALL отобразить кнопку "Написать статью"
3. WHEN автор находится на странице своей публикации THEN система SHALL отобразить кнопку "Редактировать"
4. WHILE пользователь авторизован как админ THEN система SHALL отобразить ссылку на админ-панель в меню пользователя
